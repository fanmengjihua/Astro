---
---

<h1>文章管理</h1>
<a href="/admin/edit">➕ 新建文章</a>
<div id="list"></div>

<script type="module">
// API configuration
const API = 'https://jiaweidao-workers.xxoo443.workers.dev';

const api = {
  getPosts() {
    return fetch(`${API}/posts`, {
      credentials: 'include'
    }).then(r => r.json());
  },
  save(data) {
    return fetch(`${API}/posts`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
      credentials: 'include'
    });
  },
  publish(id) {
    return fetch(`${API}/publish/${id}`, {
      method: 'POST',
      credentials: 'include'
    });
  },
  uploadImage(file) {
    const formData = new FormData();
    formData.append('image', file);
    return fetch(`${API}/upload`, {
      method: 'POST',
      body: formData,
      credentials: 'include'
    }).then(r => r.json());
  }
};

const list = document.getElementById('list');
const posts = await api.getPosts();

list.innerHTML = posts.map(p =>
  `<div>
     <b>${p.title}</b> [${p.status}]
     <button onclick="publish(${p.id})">发布</button>
   </div>`
).join('');

window.publish = async id => {
  await api.publish(id);
  location.reload();
};
</script>
